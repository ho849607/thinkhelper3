<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>ThinkHelper â€” Offline Editor (Safe Minimal)</title>
<link rel="icon" href="data:,"/>
<style>
:root{--bg:#fff;--fg:#0b1020;--muted:#6b7280;--panel:#f6f8fc;--border:#d7deea;--hover:#eef3ff;--blue:#2b4acb}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--fg);font-family:-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Arial,sans-serif;display:flex;flex-direction:column}
.top{display:flex;gap:8px;align-items:center;padding:6px 10px;background:#f1f5ff;border-bottom:1px solid var(--border)}
.logo{width:18px;height:18px;border-radius:5px;background:linear-gradient(135deg,#60a5fa,#34d399)}
.badge{background:#edf2ff;border:1px solid #cbdafc;color:var(--blue);border-radius:999px;padding:.25rem .6rem;font-size:.85rem;cursor:pointer}
.sep{width:1px;height:24px;background:var(--border);margin:0 6px}
.top select,.top button,.top input[type="text"]{height:30px;border:1px solid var(--border);border-radius:8px;background:#fff;padding:0 8px}
.top input[type="text"]{min-width:260px}

.ribbon{background:#fff;border-bottom:1px solid var(--border)}
.rrow{display:flex;align-items:center;gap:10px;padding:8px 10px;flex-wrap:wrap}
.rbtn{display:flex;flex-direction:column;align-items:center;gap:4px;width:64px;padding:8px 4px;border-radius:8px;cursor:pointer;border:1px solid transparent}
.rbtn:hover{background:var(--hover)}
.rbtn .ico{width:22px;height:22px;border:1px solid var(--border);border-radius:6px;display:flex;align-items:center;justify-content:center;background:#fff}

main{flex:1;min-height:0;display:grid;grid-template-columns:200px 1fr 360px;gap:10px;padding:10px}
@media (max-width:1200px){main{grid-template-columns:0 1fr 0} #left,#right{display:none}}
aside{border:1px solid var(--border);border-radius:10px;background:#fff;min-height:0}
#docList{padding:10px;display:flex;flex-direction:column;gap:8px}
.doc{padding:8px;border:1px solid var(--border);border-radius:10px;display:flex;justify-content:space-between;gap:8px}
.doc:hover{background:var(--hover)}

#canvasWrap{border:1px solid var(--border);border-radius:12px;background:#fff;min-height:68vh;display:flex;flex-direction:column}
#editor{min-height:60vh;padding:18px;outline:0}
#statusBar{display:flex;gap:10px;align-items:center;justify-content:space-between;border-top:1px solid var(--border);padding:6px 10px;color:var(--muted);font-size:.9rem}

#rightHead{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid var(--border)}
#preview{border:0;width:100%;height:100%}

.mask{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:80}
.card{width:min(92vw,760px);background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:8px 0}
.card input[type="text"],.card select{height:34px;border:1px solid var(--border);border-radius:8px;padding:0 10px}

#chatFab{position:fixed;right:14px;bottom:14px;width:54px;height:54px;border-radius:50%;background:#2b4acb;color:#fff;border:none;box-shadow:0 8px 20px rgba(0,0,0,.25);cursor:pointer;z-index:75}
#chatDock{position:fixed;right:12px;bottom:82px;width:min(92vw,720px);height:70vh;background:#fff;border:1px solid var(--border);border-radius:12px;display:none;flex-direction:column;box-shadow:0 12px 28px rgba(0,0,0,.2);z-index:74}
#chatHead{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid var(--border)}
#chatBody{flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:8px;background:var(--panel)}
.bubble{max-width:85%;padding:.65rem .85rem;border:1px solid var(--border);border-radius:12px;background:#fff;line-height:1.55}
.me{margin-left:auto;background:#edf2ff;border-color:#cad6ff}.ai{margin-right:auto}
#chatForm{display:flex;gap:8px;padding:8px;border-top:1px solid var(--border)}
#chatInput{flex:1;border:1px solid var(--border);border-radius:10px;padding:.7rem .9rem}

footer{padding:8px 10px;border-top:1px solid var(--border);color:var(--muted);background:#fff;display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap}
#geoCell{opacity:.9}
</style>
</head>
<body>
  <div class="top">
    <div style="display:flex;gap:8px;align-items:center">
      <span class="logo"></span><b>ThinkHelper</b>
    </div>
    <span class="sep"></span>
    <button id="btnSettings" class="badge">ì„¤ì •</button>
    <button id="btnTools" class="badge">ë„êµ¬</button>
    <span class="sep"></span>
    <select id="langSel" title="ì–¸ì–´">
      <option value="ko">í•œêµ­ì–´</option><option value="en">English</option><option value="ja">æ—¥æœ¬èª</option>
    </select>
    <span class="sep"></span>
    <button id="btnPrint" class="badge">ì¸ì‡„</button>
    <span style="flex:1"></span>
    <input id="quickSearch" type="text" placeholder="ê²€ìƒ‰ ë˜ëŠ” URL (âŒ˜/Ctrl+K)"/>
    <button id="btnGo" class="badge">ì´ë™</button>
  </div>

  <div class="ribbon">
    <div class="rrow">
      <div class="rbtn" id="bNew"><div class="ico">ğŸ“</div><div>ìƒˆë¬¸ì„œ</div></div>
      <div class="rbtn" id="bOpen"><div class="ico">ğŸ“‚</div><div>ë¶ˆëŸ¬ì˜¤ê¸°</div></div>
      <div class="rbtn" id="bSave"><div class="ico">ğŸ’¾</div><div>ì €ì¥</div></div>
      <div class="sep"></div>
      <div class="rbtn" id="expPDF"><div class="ico">PDF</div><div>PDF</div></div>
      <div class="rbtn" id="expDOCX"><div class="ico">DOCX</div><div>DOCX</div></div>
      <div class="rbtn" id="expPPT"><div class="ico">PPT</div><div>PPTX</div></div>
      <div class="rbtn" id="expHWP"><div class="ico">HWP</div><div>HWP</div></div>
      <div class="rbtn" id="nl2ppt"><div class="ico">ğŸª„</div><div>ìì—°ì–´â†’PPT</div></div>
    </div>
  </div>

  <main>
    <aside id="left">
      <div style="padding:10px;border-bottom:1px solid var(--border)"><b id="t_docs">ë¬¸ì„œ</b></div>
      <div id="docList"></div>
    </aside>

    <section id="center">
      <div id="canvasWrap">
        <div id="editor" contenteditable="true" spellcheck="false"></div>
        <div id="statusBar">
          <span id="langNow">KR</span>
          <span id="zoomWrap">ì¤Œ:
            <select id="zoomSel">
              <option>100%</option><option selected>120%</option><option>160%</option><option>200%</option>
            </select>
          </span>
        </div>
      </div>
    </section>

    <aside id="right">
      <div id="rightHead"><b>Research</b><button id="openNewTab" class="badge">â†—</button></div>
      <iframe id="preview" sandbox="allow-scripts allow-same-origin allow-forms allow-popups" referrerpolicy="no-referrer"></iframe>
    </aside>
  </main>

  <footer>
    <div>Â© ThinkHelper â€” ì €ì¥ âŒ˜/Ctrl+S Â· ê²€ìƒ‰ âŒ˜/Ctrl+K</div>
    <div id="geoCell">ğŸ“ IP í™•ì¸ ì¤‘â€¦</div>
  </footer>

  <!-- ì„¤ì • ëª¨ë‹¬ -->
  <div id="settingsMask" class="mask">
    <div class="card">
      <h3>ì„¤ì •</h3>
      <div class="row">
        <label>ì–¸ì–´
          <select id="m_langSel">
            <option value="ko">í•œêµ­ì–´</option><option value="en">English</option><option value="ja">æ—¥æœ¬èª</option>
          </select>
        </label>
        <label style="margin-left:12px">ì¶”ì²œì–´ <input type="checkbox" id="optSugg" checked/></label>
      </div>
      <div class="row" style="justify-content:flex-end">
        <button id="closeSettings" class="badge">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ë„êµ¬ ëª¨ë‹¬ -->
  <div id="toolsMask" class="mask">
    <div class="card">
      <h3>ë„êµ¬</h3>
      <div class="row">
        <button id="t_pdf" class="badge">PDF</button>
        <button id="t_docx" class="badge">DOCX</button>
        <button id="t_ppt" class="badge">PPTX</button>
        <button id="t_hwp" class="badge">HWP</button>
      </div>
      <div class="row" style="justify-content:flex-end">
        <button id="closeTools" class="badge">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ì±„íŒ… -->
  <button id="chatFab" title="ì±„íŒ…">ğŸ’¬</button>
  <div id="chatDock" role="dialog" aria-hidden="true">
    <div id="chatHead">
      <span>ì±„íŒ…</span>
      <div style="display:flex;gap:6px">
        <button id="chatExport">â¤´ï¸ ë‚´ë³´ë‚´ê¸°(JSON)</button>
        <button id="chatClose">âœ–</button>
      </div>
    </div>
    <div id="chatBody"></div>
    <form id="chatForm">
      <input id="chatInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš” (Enter)"/>
      <button class="badge" type="submit">ì „ì†¡</button>
    </form>
  </div>

  <!-- ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ (ìˆœìˆ˜ JS, IIFEë¡œ ëê¹Œì§€ ë‹«í˜) -->
  <script>
  (function(){
    const qs=(s)=>document.querySelector(s), qa=(s)=>document.querySelectorAll(s);
    const I18N={ko:{searchPh:"ê²€ìƒ‰ ë˜ëŠ” URL (âŒ˜/Ctrl+K)",docs:"ë¬¸ì„œ"},en:{searchPh:"Search or URL (âŒ˜/Ctrl+K)",docs:"Documents"},ja:{searchPh:"æ¤œç´¢/URL (âŒ˜/Ctrl+K)",docs:"ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ"}};
    const CONF={lang:localStorage.getItem("th.lang")||"ko",sugg:localStorage.getItem("th.sugg")==="0"?0:1};

    // i18n
    function applyLang(lc){
      qs("#quickSearch").placeholder=I18N[lc]?.searchPh||I18N.ko.searchPh;
      qs("#langNow").textContent=(lc==="ko"?"KR":lc.toUpperCase());
      qs("#t_docs").textContent=I18N[lc]?.docs||I18N.ko.docs;
      renderList();
    }
    qs("#langSel").value=CONF.lang; qs("#m_langSel").value=CONF.lang; applyLang(CONF.lang);
    function setLang(v){CONF.lang=v;localStorage.setItem("th.lang",v);qs("#langSel").value=v;qs("#m_langSel").value=v;applyLang(v);}
    qs("#langSel").onchange=(e)=>setLang(e.target.value);
    qs("#m_langSel").onchange=(e)=>setLang(e.target.value);
    qs("#optSugg").checked=!!CONF.sugg; qs("#optSugg").onchange=(e)=>{CONF.sugg=e.target.checked?1:0;localStorage.setItem("th.sugg",CONF.sugg);};

    // ìœ„ì¹˜/IP
    (async function geo(){
      try{
        const r=await fetch("https://ipapi.co/json/"); const j=await r.json();
        const city=j?.city||"", cc=(j?.country_code||"").toUpperCase(), ip=j?.ip||"";
        qs("#geoCell").textContent=(city||cc)?`ğŸ“ ${city}${city&&cc?" Â· ":""}${cc} (IP ${ip})`:"ğŸ“ í™•ì¸ ì‹¤íŒ¨";
      }catch{ qs("#geoCell").textContent="ğŸ“ í™•ì¸ ì‹¤íŒ¨(ì˜¤í”„ë¼ì¸)"; }
    })();

    // Editor helpers
    function getHTML(){ return qs("#editor").innerHTML || ""; }
    function setHTML(h){ qs("#editor").innerHTML=h||""; }

    // Docs(localStorage)
    const store={listKey:"th.docs",docKey:id=>`th.doc.${id}`};
    function listDocs(){try{return JSON.parse(localStorage.getItem(store.listKey)||"[]");}catch{return[];}}
    function saveList(a){localStorage.setItem(store.listKey,JSON.stringify(a));}
    function renderList(){
      const L=listDocs();
      qs("#docList").innerHTML=L.map(d=>`<div class="doc" data-id="${d.id}"><span>${d.title||"Untitled"}</span><span style="color:#6b7280;font-size:.85rem">${new Date(d.updatedAt||Date.now()).toLocaleString()}</span></div>`).join("")||`<div style="padding:8px;color:#6b7280">ì €ì¥ëœ ${I18N[CONF.lang].docs} ì—†ìŒ</div>`;
      qa("#docList .doc").forEach(n=> n.onclick=()=>openDoc(n.dataset.id));
    }
    function openDoc(id){const d=JSON.parse(localStorage.getItem(store.docKey(id))||"null"); if(!d)return; setHTML(d.html||""); currentId=id;}
    let currentId="";
    function saveDoc(){
      const id=currentId||("d_"+Date.now());
      const html=getHTML(); const title=(html.replace(/<[^>]+>/g,"").trim().split(/\n/)[0]||"Untitled").slice(0,60);
      const doc={id,html,title,updatedAt:Date.now()};
      localStorage.setItem(store.docKey(id),JSON.stringify(doc));
      const L=listDocs().filter(x=>x.id!==id); L.unshift({id,title:doc.title,updatedAt:doc.updatedAt}); saveList(L); currentId=id; renderList();
    }
    qs("#bNew").onclick=()=>{currentId="d_"+Date.now(); setHTML("");};
    qs("#bOpen").onclick=()=>{const L=listDocs(); if(!L.length){alert("ì €ì¥ëœ ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤.");return;} const t=prompt("ì—´ ë¬¸ì„œ ID:\n"+L.map(d=>`${d.id}: ${d.title}`).join("\n")); if(t) openDoc(t.trim());};
    qs("#bSave").onclick=saveDoc;
    renderList();

    // Export / Print
    qs("#btnPrint").onclick=()=>window.print();
    function needsServer(){ alert("ì´ ê¸°ëŠ¥ì€ ì„œë²„(app.js)ê°€ í•„ìš”í•©ë‹ˆë‹¤."); }
    qs("#expPDF").onclick=()=>window.print(); // ë¸Œë¼ìš°ì € ì¸ì‡„â†’PDF
    qs("#t_pdf").onclick=()=>window.print();
    qs("#expDOCX").onclick=()=> (window.App?.exportDOCX ? window.App.exportDOCX(getHTML()) : needsServer());
    qs("#t_docx").onclick=()=> (window.App?.exportDOCX ? window.App.exportDOCX(getHTML()) : needsServer());
    qs("#expPPT").onclick =()=> (window.App?.exportPPT  ? window.App.exportPPT(getHTML())   : needsServer());
    qs("#t_ppt").onclick  =()=> (window.App?.exportPPT  ? window.App.exportPPT(getHTML())   : needsServer());
    qs("#expHWP").onclick =()=> (window.App?.exportHWP  ? window.App.exportHWP(getHTML())   : needsServer());
    qs("#t_hwp").onclick  =()=> (window.App?.exportHWP  ? window.App.exportHWP(getHTML())   : needsServer());
    qs("#nl2ppt").onclick =()=> { const t=prompt("ìì—°ì–´ ì…ë ¥ â†’ PPT ìƒì„±"); if(!t)return; (window.App?.nlToPPT ? window.App.nlToPPT(t) : needsServer()); };

    // ê²€ìƒ‰/ë¦¬ì„œì¹˜
    const preview=qs("#preview");
    const EMBED_BLOCK=[/google\./i,/naver\./i,/amazon\./i,/coupang\./i,/instagram\./i,/twitter\.com|x\.com/i,/accounts\.google\.com/i];
    function toReaderURL(u){const url=/^https?:\/\//i.test(u)?u:("https://"+u.replace(/^\/+/,"")); return "https://r.jina.ai/http/"+url.replace(/^https?:\/\//,"");}
    function openPreview(input){
      const q=(input||"").trim(); if(!q) return;
      if(/^https?:\/\//i.test(q)){ if(EMBED_BLOCK.some(re=>re.test(q))){ window.open(q,"_blank","noopener"); preview.src=toReaderURL(q); } else { preview.src=q; } }
      else{
        if(/í˜•ë²•.*\d+ì¡°/.test(q)){ const url="https://www.law.go.kr/LSW/lsInfoP.do?lsiSeq=61603#J"+encodeURIComponent(q.match(/\d+/)[0]); preview.src=toReaderURL(url); return; }
        const url="https://www.google.com/search?q="+encodeURIComponent(q); window.open(url,"_blank","noopener"); preview.src=toReaderURL(url);
      }
    }
    qs("#btnGo").onclick=()=>openPreview(qs("#quickSearch").value);
    qs("#openNewTab").onclick=()=>{const src=preview.src||"about:blank"; if(src) window.open(src,"_blank","noopener");};
    document.addEventListener("keydown",(e)=>{const k=(e.key||"").toLowerCase(); if((e.metaKey||e.ctrlKey)&&k==="k"){e.preventDefault(); qs("#quickSearch").focus();} if((e.metaKey||e.ctrlKey)&&k==="s"){e.preventDefault(); saveDoc();}});

    // ëª¨ë‹¬
    qs("#btnSettings").onclick=()=>{qs("#m_langSel").value=CONF.lang; qs("#optSugg").checked=!!CONF.sugg; qs("#settingsMask").style.display="flex";};
    qs("#closeSettings").onclick=()=> (qs("#settingsMask").style.display="none");
    qs("#btnTools").onclick=()=> (qs("#toolsMask").style.display="flex");
    qs("#closeTools").onclick=()=> (qs("#toolsMask").style.display="none");

    // ì±„íŒ…
    const chatDock=qs("#chatDock"), chatBody=qs("#chatBody");
    function addBubble(who,text){const d=document.createElement("div"); d.className="bubble "+who; d.textContent=text; chatBody.appendChild(d); chatBody.scrollTop=chatBody.scrollHeight;}
    function saveLocalChat(role,content){const msgs=JSON.parse(localStorage.getItem("th.chatLocal")||"[]"); msgs.push({role,content,ts:Date.now()}); localStorage.setItem("th.chatLocal",JSON.stringify(msgs));}
    function loadChat(){chatBody.innerHTML=""; (JSON.parse(localStorage.getItem("th.chatLocal")||"[]")).forEach(m=>addBubble(m.role==="user"?"me":"ai",m.content));}
    qs("#chatFab").onclick=()=>{chatDock.style.display=chatDock.style.display==="flex"?"none":"flex"; if(chatDock.style.display==="flex") loadChat();};
    qs("#chatClose").onclick=()=> (chatDock.style.display="none");
    qs("#chatExport").onclick=()=>{const msgs=localStorage.getItem("th.chatLocal")||"[]"; const a=document.createElement("a"); a.href=URL.createObjectURL(new Blob([msgs],{type:"application/json"})); a.download="thinkhelper_chat.json"; a.click(); URL.revokeObjectURL(a.href);};
    qs("#chatForm").addEventListener("submit",(e)=>{e.preventDefault(); const i=qs("#chatInput"); const msg=i.value.trim(); if(!msg)return; i.value=""; addBubble("me",msg); saveLocalChat("user",msg); const reply="ì˜¤í”„ë¼ì¸ ëª¨ë“œ: ì„œë²„(app.js) ì—°ê²° ì‹œ ì •êµ ë‹µë³€/ì¶”ì²œ í™œì„±í™”ë©ë‹ˆë‹¤."; addBubble("ai",reply); saveLocalChat("assistant",reply);});

    // ì¤Œ
    qs("#zoomSel").onchange=(e)=>{const v=parseInt(e.target.value); qs("#editor").style.zoom=(v/100);};

    // ê²€ìƒ‰ ë‹¨ì¶•í‚¤ í¬ì»¤ìŠ¤
    console.log("[ThinkHelper Minimal] ready");
  })();
  </script>
</body>
</html>
