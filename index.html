<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ThinkHelper â€” Offline Editor</title>
  <link rel="icon" href="data:,">
  <style>
    :root{--bg:#fff;--fg:#0b1020;--muted:#5b6479;--panel:#f6f8fc;--border:#d7deea;--hover:#eef3ff;--accent:#2b4acb;--editor-bg:#fff}
    :root.dev{--bg:#0f172a;--fg:#e5e7eb;--muted:#94a3b8;--panel:#0b1222;--border:#25324a;--hover:#151e34;--accent:#60a5fa;--editor-bg:#0b1222}
    *{box-sizing:border-box}html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Noto Sans JP,Arial,sans-serif;display:flex;flex-direction:column;padding-bottom:42px}

    /* Top */
    .top{display:flex;align-items:center;gap:8px;padding:6px 10px;background:#f1f5ff;border-bottom:1px solid var(--border)}
    :root.dev .top{background:#0b1222}
    .logo{width:18px;height:18px;border-radius:5px;background:linear-gradient(135deg,#60a5fa,#34d399)}
    .badge{background:#edf2ff;border:1px solid #cbdafc;color:var(--accent);border-radius:999px;padding:.25rem .6rem;font-size:.85rem;cursor:pointer}
    :root.dev .badge{background:#101a2e;border-color:#1f2b45}
    .sep{width:1px;height:24px;background:var(--border);margin:0 6px}
    input[type="text"],select{height:30px;border:1px solid var(--border);border-radius:8px;background:#fff;padding:0 8px;color:#0b1020}
    :root.dev input[type="text"],:root.dev select{background:#0b1222;color:#e5e7eb;border-color:#24324b}

    /* Ribbon */
    .ribbon{background:#fff;border-bottom:1px solid var(--border)}
    :root.dev .ribbon{background:#0b1222}
    .rrow{display:flex;align-items:center;gap:10px;padding:8px 10px;flex-wrap:wrap}
    .rbtn{display:flex;flex-direction:column;align-items:center;gap:4px;width:64px;padding:8px 4px;border-radius:8px;cursor:pointer;border:1px solid transparent}
    .rbtn:hover{background:var(--hover)}
    .rbtn .ico{width:22px;height:22px;border:1px solid var(--border);border-radius:6px;display:flex;align-items:center;justify-content:center;background:#fff}
    :root.dev .rbtn .ico{background:#0b1222}

    /* Layout */
    main{flex:1;min-height:0;display:grid;grid-template-columns:220px 1fr 360px;gap:10px;padding:10px}
    @media (max-width:1240px){main{grid-template-columns:0 1fr 0}#left,#right{display:none}}
    aside#left,aside#right{border:1px solid var(--border);border-radius:10px;background:#fff;min-height:0;display:flex;flex-direction:column}
    :root.dev aside#left,:root.dev aside#right{background:#0b1222}
    #docList{padding:10px;display:flex;flex-direction:column;gap:8px;overflow:auto}
    .doc{padding:8px;border:1px solid var(--border);border-radius:10px;cursor:pointer;display:flex;justify-content:space-between;gap:8px}
    .doc:hover{background:var(--hover)}
    #rightHead{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid var(--border)}
    #preview{border:0;width:100%;height:100%}

    /* Editor */
    #canvasWrap{position:relative;border:1px solid var(--border);border-radius:12px;background:var(--editor-bg);min-height:68vh;display:flex;flex-direction:column}
    #editor{min-height:60vh;padding:18px;outline:none;white-space:pre-wrap}
    .toolbar{display:flex;gap:10px;align-items:center;padding:6px 10px;border-top:1px solid var(--border);color:var(--muted);font-size:.9rem}

    /* Suggest */
    #hintPanel{position:absolute;z-index:30;display:none;min-width:300px;max-width:520px;max-height:260px;overflow:auto;background:#fff;border:1px solid var(--border);border-radius:10px;box-shadow:0 10px 24px rgba(0,0,0,.18);padding:6px}
    :root.dev #hintPanel{background:#0b1222}
    .hint-item{padding:6px 8px;border-radius:6px;cursor:pointer}
    .hint-item:hover,.hint-item.active{background:var(--hover)}

    /* Chat FAB */
    #fab{position:fixed;right:16px;bottom:60px;width:44px;height:44px;border-radius:999px;background:#111827;color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 10px 24px rgba(0,0,0,.25);z-index:60}
    #chatDock{position:fixed;right:12px;bottom:110px;width:min(92vw,720px);height:70vh;background:#fff;border:1px solid var(--border);border-radius:12px;display:none;flex-direction:column;box-shadow:0 12px 28px rgba(0,0,0,.2);z-index:70}
    :root.dev #chatDock{background:#0b1222}
    #chatHead{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid var(--border)}
    #chatBody{flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:8px;background:#fff}
    :root.dev #chatBody{background:#0b1222}
    .bubble{max-width:85%;padding:.65rem .85rem;border:1px solid var(--border);border-radius:12px;background:#fff;line-height:1.55}
    .me{margin-left:auto;background:#edf2ff;border-color:#cad6ff}
    .ai{margin-right:auto}

    /* Gaze / reading line */
    #gazeDot{position:fixed;left:0;top:0;width:14px;height:14px;border-radius:50%;
      background:rgba(37,99,235,.9);box-shadow:0 0 0 6px rgba(37,99,235,.15);
      pointer-events:none;z-index:90;transform:translate(-50%,-50%);display:none}
    body.gaze-on #gazeDot{display:block}
    #readLine{position:absolute;left:0;right:0;height:22px;background:rgba(99,102,241,.15);
      border-top:1px solid rgba(99,102,241,.35);border-bottom:1px solid rgba(99,102,241,.35);
      pointer-events:none;display:none}

    /* Modals */
    .mask{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:80}
    .card{width:min(92vw,780px);background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px}
    .card h3{margin:0 0 8px}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:8px 0}
    .card input[type="text"],.card input[type="password"],.card select{height:34px;border:1px solid var(--border);border-radius:8px;padding:0 10px}

    /* Footer */
    footer{position:fixed;left:0;right:0;bottom:0;padding:8px 10px;border-top:1px solid var(--border);color:var(--muted);background:#fff;display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap;z-index:5}
    :root.dev footer{background:#0b1222}
  </style>
</head>
<body>
  <!-- Top -->
  <div class="top">
    <div style="display:flex;gap:8px;align-items:center">
      <span class="logo"></span><b>ThinkHelper</b>
    </div>
    <span class="sep"></span>
    <button id="btnTools" class="badge">ë„êµ¬</button>
    <button id="btnSettings" class="badge">ì„¤ì •</button>
    <span class="sep"></span>
    <select id="langSel" title="ì–¸ì–´">
      <option value="ko">í•œêµ­ì–´</option><option value="en">English</option><option value="ja">æ—¥æœ¬èª</option>
    </select>
    <select id="modeSel" title="ëª¨ë“œ" style="margin-left:6px">
      <option value="general">ì¼ë°˜</option>
      <option value="research">ë¦¬ì„œì¹˜</option>
      <option value="legal">ë¦¬ê±¸</option>
      <option value="dev">ê°œë°œì</option>
    </select>
    <span class="sep"></span>
    <input id="quickSearch" type="text" placeholder="ê²€ìƒ‰ ë˜ëŠ” URL (âŒ˜/Ctrl+K)"/>
    <button id="btnGo" class="badge">ì´ë™</button>
  </div>

  <!-- Ribbon -->
  <div class="ribbon">
    <div class="rrow">
      <div class="rbtn" id="bNew"><div class="ico">ğŸ“</div><div>ìƒˆë¬¸ì„œ</div></div>
      <div class="rbtn" id="bOpen"><div class="ico">ğŸ“‚</div><div>ë¶ˆëŸ¬ì˜¤ê¸°</div></div>
      <div class="rbtn" id="bSave"><div class="ico">ğŸ’¾</div><div>ì €ì¥</div></div>
      <div class="rbtn" id="bPrint"><div class="ico">ğŸ–¨ï¸</div><div>ì¸ì‡„</div></div>
      <div class="sep"></div>
      <div class="rbtn" id="expPDF"><div class="ico">PDF</div><div>PDF</div></div>
      <div class="rbtn" id="expDOCX"><div class="ico">DOCX</div><div>DOCX</div></div>
      <div class="rbtn" id="expPPT"><div class="ico">PPT</div><div>PPT</div></div>
      <div class="rbtn" id="expHWP"><div class="ico">HWP</div><div>HWP</div></div>
    </div>
    <div class="rrow">
      <div>ê¸€ê¼´</div>
      <select id="fontSel"><option>ë‚˜ëˆ”ê³ ë”•</option><option>ë§‘ì€ ê³ ë”•</option><option>Apple SD Gothic Neo</option><option selected>Roboto</option></select>
      <div>í¬ê¸°</div>
      <select id="sizeSel"><option>13</option><option selected>16</option><option>18</option><option>22</option><option>28</option></select> pt
      <span style="flex:1"></span>
      <input id="findBox" type="text" placeholder="ë¬¸ì„œ ë‚´ ì°¾ê¸° ( / )" style="width:220px">
    </div>
  </div>

  <main>
    <aside id="left" aria-label="ë¬¸ì„œëª©ë¡">
      <div style="padding:10px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px"><b>ë¬¸ì„œ</b></div>
      <div id="docList"></div>
    </aside>

    <section id="center">
      <div id="canvasWrap">
        <div id="editor" contenteditable="true" spellcheck="false" placeholder="ì—¬ê¸°ì— ì‘ì„±í•˜ì„¸ìš”â€¦"></div>
        <div class="toolbar">
          <span id="langNow">KR</span>
          <span style="margin-left:auto">ì¤Œ:
            <select id="zoomSel">
              <option>100%</option><option selected>120%</option><option>140%</option><option>160%</option><option>200%</option>
            </select>
          </span>
        </div>
        <div id="readLine" aria-hidden="true"></div>
      </div>
    </section>

    <aside id="right">
      <div id="rightHead"><b>Research</b><button id="openNewTab" class="badge">â†—</button></div>
      <iframe id="preview" sandbox="allow-scripts allow-same-origin allow-forms allow-popups" referrerpolicy="no-referrer"></iframe>
    </aside>
  </main>

  <!-- Chat -->
  <div id="fab" title="ì±„íŒ…">ğŸ’¬</div>
  <div id="chatDock" role="dialog" aria-hidden="true">
    <div id="chatHead">
      <span>ì±„íŒ…</span>
      <div style="display:flex;gap:6px">
        <button id="chatExport" class="badge">â¤´ï¸ ë‚´ë³´ë‚´ê¸°</button>
        <button id="chatClose" class="badge">âœ–</button>
      </div>
    </div>
    <div id="chatBody"></div>
    <form id="chatForm" style="display:flex;gap:8px;padding:8px;border-top:1px solid var(--border)">
      <input id="chatInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš” (Enter)" style="flex:1"/>
      <button class="badge" type="submit">ì „ì†¡</button>
    </form>
    <div style="padding:0 10px 10px;color:var(--muted)">ì˜¤í”„ë¼ì¸ ë¡œì»¬ ë©”ëª¨ìš© ì±„íŒ…ì…ë‹ˆë‹¤.</div>
  </div>

  <!-- Hint panel -->
  <div id="hintPanel"></div>

  <!-- Tools Modal -->
  <div id="toolsMask" class="mask">
    <div class="card">
      <h3>ë„êµ¬</h3>
      <div class="row">
        <button id="t_pdf"  class="badge">PDF ë‚´ë³´ë‚´ê¸°</button>
        <button id="t_docx" class="badge">DOCX ë‚´ë³´ë‚´ê¸°</button>
        <button id="t_ppt"  class="badge">PPT ë‚´ë³´ë‚´ê¸°</button>
        <button id="t_hwp"  class="badge">HWP ë‚´ë³´ë‚´ê¸°</button>
        <span style="flex:1"></span>
        <button id="closeTools">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsMask" class="mask">
    <div class="card">
      <h3>ì„¤ì •</h3>
      <div class="row">
        <label>ì–¸ì–´
          <select id="m_langSel">
            <option value="ko">í•œêµ­ì–´</option><option value="en">English</option><option value="ja">æ—¥æœ¬èª</option>
          </select>
        </label>
        <label style="margin-left:12px">ëª¨ë“œ
          <select id="m_modeSel">
            <option value="general">ì¼ë°˜</option><option value="research">ë¦¬ì„œì¹˜</option><option value="legal">ë¦¬ê±¸</option><option value="dev">ê°œë°œì</option>
          </select>
        </label>
      </div>
      <div class="row">
        <label>API Base <input id="apiBase" type="text" style="min-width:280px" value="http://127.0.0.1:1234"></label>
        <input id="apiKey" type="password" placeholder="API Key(ì„ íƒ)" style="min-width:200px">
        <button id="saveModel" class="badge">ì €ì¥</button>
      </div>
      <div class="row" style="justify-content:flex-end">
        <button id="closeSettings">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div>Â© ThinkHelper â€” ì €ì¥ âŒ˜/Ctrl+S Â· ê²€ìƒ‰ âŒ˜/Ctrl+K Â· ì¶”ì²œ âŒ˜/Ctrl+Space</div>
    <div id="geoCell">ğŸ“ IP í™•ì¸ ì¤‘â€¦</div>
    <div>ì œì•ˆ/ë¬¸ì˜: <a href="mailto:ho849607@gmail.com">ho849607@gmail.com</a></div>
  </footer>

  <div id="gazeDot" aria-hidden="true"></div>

  <!-- ë¶„ë¦¬ëœ ìŠ¤í¬ë¦½íŠ¸ -->
  <script defer src="./app.js"></script>
  <!-- Optional: html-docx-js (DOCX í’ˆì§ˆ í–¥ìƒ) -->
  <script defer src="https://unpkg.com/html-docx-js/dist/html-docx.js"></script>
</body>
</html>
